---
title: "Milestone 4"
author: "George Guarnieri"
date: "10/11/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE)
```



```{r}
full_rawdata<-read.csv("sales_2016-10-18_2019-10-18.csv")
full_rawdata
```





```{r}

# Installed all necessary libraries

library(tidyverse)
library(dplyr)
library(ggplot2)
library(lubridate)
library(zoo)
library(gganimate)
library(png)

# Made a directory for graphics
dir.create('graphics')
# Read in the CSV file containing the data
vend_data_2_years<-read_csv("Milestone-6/vend-total_revenue-for-product-by-month (2).csv")

# Created a plot of Web Revenue by year.

vend_1<-vend_data_2_years%>%

# Arranged the data by descending revenue value. Selected the top 10 products in terms of Revenue. 
  
  arrange(desc(Revenue))%>%
  head(10)%>%
  
# Used the gather function to tame the data with key value pairs.
  
  gather(key="Month/Year", value="Revenue", `Nov 2017`:`Oct 2019`)%>%
  
# Selected the relevant variables
  
  select(Product, 'Month/Year', Revenue)%>%
  
# Extracted the years and grouped by product and year
  
  separate('Month/Year',c("Month","Year"))%>%
  group_by(Product,Year)%>%
  
# Summarized the sum of the revenue by product and year
  
  summarize(revenue=sum(Revenue))

# Created a plot showing revenue by product by year. Used a column chart and facet wrapped by year. Gave the chart a title, subtitle, and axis labels. Removed the tick labels from the x-axis since they were too crowded.
  
vend_data_2_years

plot<-ggplot(vend_1,aes(x=Product,y=revenue,group=Product,fill=Product))+geom_col()+facet_wrap(~Year)+labs(title="Web Revenue by Product 2017-2019",subtitle="Data Sourced From Vend",y="Revenue",x="Product")+theme(axis.text.x=element_blank(),axis.ticks.x=element_blank())

saveRDS(plot,file='graphics/plot.rds')

growth <- vend_data_2_years %>%
  group_by(Product) %>%
  mutate(oct2019='Oct 2019',oct2018='Oct 2018') %>%
  mutate(oct2019=as.numeric(oct2019),oct2018=as.numeric(oct2018)) 

growth


                                                                          



```

In my plot, I decided to start examining Web Sales by product. Initially, I wanted to view this over time, but I realized that it would make more sense to facet the data since I was creating a column chart. While the data was already relatively clean, I ended up having to do more work than I had originally anticipated in order to make it work for the plot I had envisioned. The biggest step was remembering that I needed to use the gather function and then figuring out how to apply it in this case. After that, I also made sure I selected what I considered the most relevant products to be by arranging the data and selecting the top 10 products in terms of revenue. Lastly, I adjusted the aesthetics of the ploy as well in terms of the color, which pleased me aesthetically. 


```{r seasonal trends}
library(tidyverse)
library(dplyr)
library(gganimate)
library(cowplot)
library(fs)
library(sf)

web_over_time_2019 <- read.csv('Other_Data/Web over time.csv')
web_over_time_2019
ggplot(web_over_time_2019,aes(x=month, y=net_sales))+geom_point()
grouped_web_over_time_2019<- web_over_time_2019 %>%
  mutate(period=1)

grouped_web_over_time_2019
  
 





time_2019_plot <- grouped_web_over_time_2019 %>%
  ggplot(aes(x=month, y=net_sales, color=month))+geom_point(size=3, aes(group=period))+transition_states(month) +     labs(x="Month", y="Net Sales") + shadow_trail()

anim_save(filename='2019webtime',animation=time_2019_plot, path='graphics')



web_over_time_2018 <- read.csv('Other_Data/2018 web over time.csv') %>%
  mutate(period=1,year=2018)



time_2018_plot <- web_over_time_2018 %>%
  ggplot(aes(x=month, y=net_sales, color=month))+geom_point(size=3, aes(group=period))+transition_states(month) + labs(x="Month", y="Net Sales")+shadow_trail()

anim_save(filename='2018webtime',animation=time_2018_plot, path='graphics')


file_copy('graphics/2018webtime', 'Milestone-6')
file_copy('graphics/2019webtime', 'Milestone-6')
file_copy('graphics/plot.rds','Milestone-6')






```

```{r}
visit<-read.csv('Milestone-6/webvisits.csv')
visit
```

```{r}
purchase<-visit %>%
  mutate(total_checkouts=ifelse(total_checkouts>1,1,0)) %>%
  filter(total_sessions<60)


lm(formula=total_checkouts~total_sessions, data=purchase, family="binomial")


purchasers<-ggplot(purchase, aes(x=total_sessions, y=total_checkouts)) + geom_point() + geom_smooth() + labs(x='Total Sessions', y='Checked Out')


saveRDS(purchasers,file='graphics/checkout_correct.rds')
file_copy('graphics/checkout_correct.rds', 'Milestone-6')



```

